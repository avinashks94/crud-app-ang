<div class="page">
  <header class="header">
    <h1>GitHub Repo Language Breakdown</h1>
    <p class="sub">
      Analyze public or private repositories via GitHub’s languages API
      (Linguist).
    </p>
  </header>

  <section class="card">
    <!-- Repo type -->
    <div class="row radio-row" role="radiogroup" aria-label="Repository Type">
      <div class="col-sm-1">
        <label class="radio inline">
          <input
            type="radio"
            name="rtype"
            [checked]="repoType() === 'public'"
            (change)="setRepoType('public')"
          />
          <span>Public</span>
        </label>
      </div>
      <div class="col-sm-1">
        <label class="radio inline">
          <input
            type="radio"
            name="rtype"
            [checked]="repoType() === 'private'"
            (change)="setRepoType('private')"
          />
          <span>Private</span>
        </label>
      </div>
    </div>

    <!-- URL -->
    <div class="row">
      <div class="col">
        <input
          class="input"
          [value]="repoUrl()"
          (input)="repoUrl.set($any($event.target).value)"
          placeholder="Enter GitHub repository URL"
          spellcheck="false"
          aria-label="Repository URL"
        />
      </div>
    </div>

    <!-- Token for private -->
    <div class="row" *ngIf="repoType() === 'private'">
      <div class="col">
        <input
          class="input"
          type="password"
          [value]="token()"
          (input)="token.set($any($event.target).value)"
          placeholder="Personal Access Token (repo read)"
          autocomplete="off"
          aria-label="GitHub Personal Access Token"
        />
      </div>
    </div>
    <!-- Button -->
    <div class="row">
      <div class="col">
        <div class="actions">
          <button
            class="btn btn-primary mb-4"
            (click)="analyze()"
            [disabled]="loading()"
          >
            <span *ngIf="!loading()">Analyze</span>
            <span *ngIf="loading()">Analyzing…</span>
          </button>
        </div>
      </div>
    </div>
    <!-- Message -->
    <div class="row">
      <div class="col">
        <div class="alert info" *ngIf="infoMsg()">{{ infoMsg() }}</div>
        <div class="alert warn" *ngIf="errorMsg()">{{ errorMsg() }}</div>
      </div>
    </div>

    <!-- Results -->

    <div class="results" *ngIf="result() as r">
      <div class="meta row text-center" *ngIf="repoMeta()">
        <div class="col"><strong>Owner:</strong> {{ repoMeta()!.owner }}</div>
        <div class="col"><strong>Repo:</strong> {{ repoMeta()!.repo }}</div>
        <div class="col">
          <strong>Total:</strong> {{ prettyBytes(r.totalBytes) }}
        </div>
      </div>
      <div class="row">
        <div class="col">
          <ul class="stats">
            <li *ngFor="let lang of orderedLangs()">
              <div class="stat-row">
                <div class="label">
                  <span class="dot" [style.background]="color(lang)"></span>
                  {{ lang }}
                </div>
                <div class="value">
                  <span class="percent">{{ r.percents[lang] }}%</span>
                  <span class="bytes">{{ prettyBytes(r.bytes[lang]) }}</span>
                </div>
              </div>
              <div class="bar">
                <div
                  class="bar-fill"
                  [style.background]="color(lang)"
                  [style.width.%]="r.percents[lang]"
                ></div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Useless files -->
    <div class="row">
      <div class="col">
        <div class="card mt-3" *ngIf="auditFindings?.length">
          <div class="card-header">
            <h2>Useless files</h2>
            <span class="muted">{{ auditFindings.length }} flagged</span>
          </div>
          <ul class="file-list">
            <li *ngFor="let f of auditFindings">
              <span
                class="badge"
                [class.err]="f.severity === 'error'"
                [class.warn]="f.severity === 'warn'"
                >{{ f.severity }}</span
              >
              <code class="path">{{ f.path }}</code>
              <span class="why" style="margin-left: 10px">{{ f.reason }}</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col">
        <p class="muted tips mt-4">
          Private: create a Personal Access Token (fine-grained) with read-only
          access to the target repo and paste it above. Never share tokens; keep
          them out of source control.
        </p>
      </div>
    </div>
  </section>
</div>
